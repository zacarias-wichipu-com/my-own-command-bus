#!/usr/bin/env php
<?php

require_once dirname(__DIR__) . '/vendor/autoload.php';

use App\Application\DisplayAwakeMessageCommand;
use App\Application\DisplayAwakeMessageCommandHandler;
use App\Application\DisplayEmojiTimeCommandHandler;
use App\Application\DisplaySleepMessageCommand;
use App\Application\DisplaySleepMessageCommandHandler;
use App\Application\DisplayTimeCommand;
use App\Application\PlayAlarmCommand;
use App\Application\PlayAlarmCommandHandler;
use App\Application\PlayBeepCommand;
use App\Application\PlayBeepCommandHandler;
use App\Infrastructure\Bus\CommandBus;
use App\Infrastructure\Bus\CommandHandlerDriver;
use App\Infrastructure\EntryPoint\RunClock;
use App\Infrastructure\Internationalisation\EnglishDisplayMessage;
use App\Infrastructure\Middleware\AlarmLogMiddleware;
use App\Infrastructure\Middleware\CommandLoggerMiddleware;

$commandHandlerDriver = new CommandHandlerDriver();
$commandHandlerDriver->registerCommands(
    commandFqn: DisplayTimeCommand::class,
    commandHandler: new DisplayEmojiTimeCommandHandler()
);
$commandHandlerDriver->registerCommands(
    commandFqn: DisplayAwakeMessageCommand::class,
    commandHandler: new DisplayAwakeMessageCommandHandler(new EnglishDisplayMessage())
);
$commandHandlerDriver->registerCommands(
    commandFqn: DisplaySleepMessageCommand::class,
    commandHandler: new DisplaySleepMessageCommandHandler(new EnglishDisplayMessage())
);
$commandHandlerDriver->registerCommands(
    commandFqn: PlayBeepCommand::class,
    commandHandler: new PlayBeepCommandHandler()
);
$commandHandlerDriver->registerCommands(
    commandFqn: PlayAlarmCommand::class,
    commandHandler: new PlayAlarmCommandHandler()
);
$commandBus = new CommandBus(
    commandHandlerDriver: $commandHandlerDriver,
    middleware: new CommandLoggerMiddleware(
        nexMiddleware: new AlarmLogMiddleware()
    )
);
$runClock = new RunClock(
    commandBus: $commandBus,
    awakeAt: 7,
    sleepAt: 22
);
($runClock)();
